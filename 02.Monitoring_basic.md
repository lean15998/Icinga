# 1. Host và Service

- Icinga2 có thể được sử dụng để theo dõi tính khả dụng của các Host và Service. Host và Service hầu như có thể là bất kỳ thứ gì có thể được kiểm tra theo một cách nào đó:
  <ul>
   <ul>
      <li> Dịch vụ mạng (HTTP, SMTP, SNMP, SSH, v.v.)
      <li> Máy in
      <li> Switch và Router
      <li> Các dịch vụ mạng hoặc cục bộ khác có thể truy cập được
      <li> v.v..
      </ul>
 </ul>
 
 ### Trạng thái của Host
 
  - UP: Host khả dụng
  - DOWN : Host không khả dụng
  
  ### Trạng thái của Service
  
- OK : Service đang hoạt động tốt
- WARNING : Service đang có 1 số vấn đề nhưng vẫn trong tình trạng làm việc.
- CRITICAL : Service đang trong trạng thái nguy hiểm
- UNKNOW : Không thể kiểm tra trạng thái của Service

###  Trạng thái Hard và Soft

- Khi có vấn đề xảy ra với host/service, Icinga2 sẽ không lập tức gửi cảnh báo đi ngay, mà sẽ tiến hành kiểm tra lại trước khi gửi cảnh báo, nhằm tránh việc những cảnh báo không quan trọng được gửi đi liên tục.
- Trong thời gian kiểm tra này, object rơi vào trạng thái SOFT
- Sau khi tất cả re-check được tiến hành, và object được kiểm tra vẫn trong trạng thái non-OK, thì host/service sẽ chuyển sang trạng thái HARD và cảnh báo được gửi đi.
- Để thay đổi thời gian và số lần kiểm tra, hãy tìm đến /etc/icinga2/conf.d/templates.conf
- Template Icinga2 cung cấp sẵn các template chứa các thông số cơ bản cho host, service, hay việc gửi cảnh báo. Ta cũng có thể tự tạo template để tùy chỉnh theo nhu cầu và import template mới vào các object.



```sh
root@quynv:~# tail -5 /etc/icinga2/conf.d/templates.conf
template Host "Host01" {
  max_check_attempts = 3
  check_interval = 1m
  retry_interval = 30s
}
```


### Kiểm tra host và Service

Đây là các service được icinga cung cấp sẵn để monitor

| Service(s) | Applied on host(s) |
| --- | --- |
|  load, procs, swap, users, icinga | The NodeName host only |
|  ping4, ping6 | All hosts with address resp. address6 attribute |
| ssh | All hosts with address and vars.os set to Linux |
| http, optional: Icinga Web 2 | All hosts with custom attribute http_vhosts defined as dictionary |
| disk, disk / | All hosts with custom attribute disks defined as dictionary |


```sh
root@quynv:~# tail -5 /etc/icinga2/conf.d/hosts.conf

object Host "local" {
  address = "10.0.0.51"
  check_command = "hostalive"
}
```

```sh
root@quynv:~# tail -5 /etc/icinga2/conf.d/services.conf
object Service "http" {
  host_name = "local"
  check_command = "ping4"
}
```


# 2. Template

  - Template có thể được sử dụng để áp dụng một tập hợp các thuộc tính giống hệt nhau cho nhiều đối tượng:

  ```sh
  root@quynv:~# cat /etc/icinga2/conf.d/templates.conf
  template Service "generic-service" {
  max_check_attempts = 3
  check_interval = 5m
  retry_interval = 1m
  enable_perfdata = true
}

apply Service "ping4" {
  import "generic-service"

  check_command = "ping4"

  assign where host.address
}

apply Service "ping6" {
  import "generic-service"

  check_command = "ping6"

  assign where host.address6
}
```

 - Import template
 
```sh
root@quynv:~# tail -6 /etc/icinga2/conf.d/services.conf
object Service "http" {
  import = "generic-service"
  host_name = "local"
  check_command = "ping4"
}
```

# 3. Biến tuỳ chỉnh

 - Có thể xác định các thuộc tính tuỳ chỉnh bằng cách dùng biến **vars**.

```sh
object Host "localhost" {
  check_command = "ssh"
  vars.ssh_port = 2222
}
```

```
vars["ssh_port"] = 2222
```

```sh
  vars.disks["disk /"] = {
    disk_partitions = "/"
  }
  
```
Hoặc có thể viết như sau:

```sh
  vars = {
    disks = {
      "disk /" = {
        disk_partitions = "/"
      }
    }
  }
```
- Hàm và biến tuỳ chỉnh

```sh
object CheckCommand "random-value" {
  command = [ PluginDir + "/check_dummy", "0", "$text$" ]

  vars.text = {{ Math.random() * 100 }}
}

object CheckCommand "my-ping" {
  command = [ PluginDir + "/check_ping" ]

  arguments = {
    "-H" = "$ping_address$"
    "-w" = "$ping_wrta$,$ping_wpl$%"
    "-c" = "$ping_crta$,$ping_cpl$%"
    "-p" = "$ping_packets$"
  }

  // Resolve from a host attribute, or custom variable.
  vars.ping_address = "$address$"

  // Default values
  vars.ping_wrta = 100
  vars.ping_wpl = 5

  vars.ping_crta = 250
  vars.ping_cpl = 10

  vars.ping_packets = 5
}

```

# 4. Runtime macro

### Host Runtime Macros

| Name | 	Description |
| -- | -- |
| host.name	| Tên của host object |
| host.display_name |	Giá trị của thuộc tính display_name |
| host.state |	Trạng thái hiện tại của host. Có thể là UNREACHABLE, UP hoặc DOWN |
| host.state_id	| ID trạng thái hiện tại của host. Có thể là một trong 0(UP), 1(DOWN) và 2(UNREACHABLE) |
| host.state_type |	Loại trạng thái hiện tại của host. Có thể là SOFT hoặc HARD |
| host.check_attempt |	Số lần kiểm tra hiện tại |
| host.max_check_attempts	| Số lần kiểm tra tối đa được thực hiện trước khi chuyển sang trạng thái HARD |
| host.last_state	| Trạng thái trước đó của host. Có thể là UNREACHABLE, UP hoặc DOWN |
| host.last_state_id | ID trạng thái trước đó của host. Có thể là 0(UP), 1(DOWN) và 2(ỦNEACHABLE) |
| host.last_state_type | Loại trạng thái trước đó của host. Có thể là SOFT hoặc HARD |
| host.last_state_change |	Dấu thời gian của thay đổi trạng thái cuối cùng |
| host.downtime_depth	| Số lần ngừng hoạt động |
| host.duration_sec |	Thời gian kể từ lần thay đổi trạng thái cuối cùng |
| host.latency	| Độ trễ kiểm tra của host |
| host.execution_time	| Thời gian thực hiện execution của host |
| host.output	| Đầu ra của check |
| host.perfdata |	Dữ liệu hiệu suất của lần kiểm tra cuối cùng |
| host.last_check	 | Dấu thời gian khi lần kiểm tra cuối cùng được thực hiện |
| host.check_source |	Phiên bản giám sát thực hiện lần kiểm tra cuối cùng |
| host.num_services	| Số lượng dịch vụ được liên kết với host |
| host.num_services_ok	| Số lượng dịch vụ được liên kết với máy chủ đang ở trạng thái OK |
| host.num_services_warning |	Số lượng dịch vụ được liên kết với máy chủ đang ở trạng thái WARNING |
| host.num_services_unknown	 | Số lượng dịch vụ được liên kết với máy chủ đang ở trạng tháiUNKNOWN |
| host.num_services_critical	|  lượng dịch vụ được liên kết với máy chủ đang ở trạng thái CRITICAL |



### Service Runtime Macros

|Name	| Description |
| -- | -- |
| service.name |	The short name of the service object |
| service.display_name	| The value of the display_name attribute |
| service.check_command	| The short name of the command along with any arguments to be used for the check |
| service.state	| The service’s current state. Can be one of OK, WARNING, CRITICAL and UNKNOWN |
| service.state_id	| The service’s current state. Can be one of 0 (ok), 1 (warning), 2 (critical) and 3 (unknown) |
| service.state_type |	The service’s current state type. Can be one of SOFT and HARD |
| service.check_attempt |	The current check attempt number |
| service.max_check_attempts |	The maximum number of checks which are executed before changing to a hard state |
| service.last_state |	The service’s previous state. Can be one of OK, WARNING, CRITICAL and UNKNOWN |
| service.last_state_id |	The service’s previous state. Can be one of 0 (ok), 1 (warning), 2 (critical) and 3 (unknown) |
| service.last_state_type |	The service’s previous state type. Can be one of SOFT and HARD |
| service.last_state_change |	The last state change’s timestamp |
| service.downtime_depth |	The number of active downtimes |
| service.duration_sec |	The time since the last state change |
| service.latency	| The service’s check latency |
| service.execution_time |	The service’s check execution time |
| service.output	| The last check’s output |
| service.perfdata	| The last check’s performance data |
| service.last_check	| The timestamp when the last check was executed |
| service.check_source	| The monitoring instance that performed the last check |

### Command Runtime Macros

| Name |	Description
| -- | -- |
| command.name	| The name of the command object |

### User Runtime Macros 

| Name	| Description |
| -- |  --- |
| user.name |	The name of the user object |
| user.display_name	| The value of the display_name attribute |

### Notification Runtime Macros 

| Name	| Description |
| notification.type	| The type of the notification. |
| notification.author	| The author of the notification comment if existing. |
| notification.comment	| The comment of the notification if existing. |

# 5. Apply Rules


###  Giám sát tất cả các host có host.address được chỉ định

```sh
apply Service "ping4" {
  check_command = "ping4"
  assign where host.address
}
```

### Áp dụng dịch vụ cho host

- Áp dụng dịch vụ cho host có host.address chỉ định và host os là Linux.

```sh
apply Service "ssh" {
  import "generic-service"

  check_command = "ssh"

  assign where host.address && host.vars.os == "Linux"
}

```

### Áp dụng Notifications cho Hosts và Services

- `mail-noc` thông báo sẽ được tạo dưới dạng đối tượng cho tất cả các dịch vụ có biến tuỳ chỉnh `notification.mail` được xác định. Lệnh thông báo được đặt thành mail-service-notification và tất cả các thành viên của nhóm người dùng noc sẽ nhận được thông báo.

```sh
apply Notification "mail-noc" to Service {
  import "mail-service-notification"

  user_groups = [ "noc" ]

  assign where host.vars.notification.mail
}
```

- Template Notìication `mail-host-notification` chứa tất cả các cài đặt thông báo có liên quan. Apply rule được áp dụng trên tất cả các host nơi quy tắc `host.address` được xác định.

Nếu host có một tập biến tùy chỉnh cụ thể, giá trị của nó sẽ được kế thừa vào phạm vi đối tượng thông báo cục bộ, ví dụ host.vars.notification_interval: host.vars.notification_periodvà host.vars.notification_type. Điều này ghi đè các thuộc tính đã được chỉ định trong template `mail-host-notification` đã nhập.

```sh
apply Notification "host-mail-noc" to Host {
  import "mail-host-notification"

  // replace interval inherited from `mail-host-notification` template with new notfication interval set by a host custom variable
  if (host.vars.notification_interval) {
    interval = host.vars.notification_interval
  }

  // same with notification period
  if (host.vars.notification_period) {
    period = host.vars.notification_period
  }

  // Send SMS instead of email if the host's custom variable `notification_type` is set to `sms`
  if (host.vars.notification_type == "sms") {
    command = "sms-host-notification"
  } else {
    command = "mail-host-notification"
  }

  user_groups = [ "noc" ]

  assign where host.address
}
```

Host tương ứng

```sh
object Host "host1" {
  import "host-linux-prod"
  display_name = "host1"
  address = "192.168.1.50"
  vars.notification_interval = 1h
  vars.notification_period = "24x7"
  vars.notification_type = "sms"
}
```


# 6. Groups
 - Tập hợp các đối tượng giống nhau

```sh
object HostGroup "windows" {
  display_name = "Windows Servers"
}
```

- Thêm host vào group

```sh
template Host "windows-server" {
  groups += [ "windows" ]
}

object Host "mssql-srv1" {
  import "windows-server"

  vars.mssql_port = 1433
}

object Host "mssql-srv2" {
  import "windows-server"

  vars.mssql_port = 1433
}
```

- Có thể áp dụng cho nhóm dịch vụ và nhóm người dùng

```sh
object UserGroup "windows-mssql-admins" {
  display_name = "Windows MSSQL Admins"
}

template User "generic-windows-mssql-users" {
  groups += [ "windows-mssql-admins" ]
}

object User "win-mssql-noc" {
  import "generic-windows-mssql-users"

  email = "noc@example.com"
}

object User "win-mssql-ops" {
  import "generic-windows-mssql-users"

  email = "ops@example.com"
}
```

### Chỉ định tư cách thành viên nhóm

- Thay vì chỉ định thủ công từng đối tượng cho một nhóm, bạn cũng có thể gán các đối tượng cho một nhóm dựa trên các thuộc tính của chúng:

```sh
object HostGroup "prod-mssql" {
  display_name = "Production MSSQL Servers"

  assign where host.vars.mssql_port && host.vars.prod_mysql_db
  ignore where host.vars.test_server == true
  ignore where match("*internal", host.name)
}
```

 Tất cả các host có thuộc tính `mssql_port` sẽ được thêm làm thành viên của hostgroup `mssql`. Tuy nhiên, tất cả các host phù hợp với chuỗi thuộc tính `internal` hoặc với `test_server` không được thêm vào nhóm này.

# 7. Thông báo

- Thông báo cho các vấn đề về service và host là một phần không thể thiếu trong thiết lập giám sát.
- Khi service và host đang gặp sự cố thì thông báo sẽ được gửi đến cho người dùng.
- Có nhiều cách để gửi thông báo, ví dụ như qua email, XMPP, IRC, Twitter, v.v. .Icinga2 không biết cách gửi thông báo. Thay vào đó, nó dựa vào các cơ chế bên ngoài như shell script để thông báo cho người dùng.

```sh
object User "icingaadmin" {
  display_name = "Icinga 2 Admin"
  enable_notifications = true
  states = [ OK, Warning, Critical ]
  types = [ Problem, Recovery ]
  email = "icinga@localhost"
}
```

- User `icingaadmin` trong ví dụ dưới đây sẽ chỉ nhận được thông báo về các trạng thái `Warning` và `Critical`. Thêm vào đó các Recovery thông báo được gửi .
- Nếu không set `states` và `types` thì tất cả các thông báo về trạng thái sẽ được gửi.

- Ví dụ một notification template 

```sh
template Notification "generic-notification" {
  interval = 15m

  command = "mail-service-notification"

  states = [ Warning, Critical, Unknown ]
  types = [ Problem, Acknowledgement, Recovery, Custom, FlappingStart,
            FlappingEnd, DowntimeStart, DowntimeEnd, DowntimeRemoved ]

  period = "24x7" //Khoảng thơi gian 24*7
}
```

- Apply keyword tạo notification cho service

```sh
apply Notification "notify-cust-xy-mysql" to Service {
  import "generic-notification"
  users = [ "noc-xy", "mgmt-xy" ]
  assign where match("*has gold support 24x7*", service.notes) && (host.vars.customer == "customer-xy" || host.vars.always_notify == true
  ignore where match("*internal", host.name) || (service.vars.priority < 2 && host.vars.is_clustered == true)
}
```

### Thông báo : User từ host/service

 - Sử dụng các quy tắc `mail` và `sms` cho các đối tượng khác nhau

```sh

object Host "icinga2-agent1.localdomain" {
  [...]

  vars.notification["mail"] = {
    groups = [ "icingaadmins" ]
    users = [ "icingaadmin" ]
  }
  vars.notification["sms"] = {
    users = [ "icingaadmin" ]
  }
}
```

- Sử dụng chi tiết hơn trên service

```sh
apply Service "http" {
  [...]

  vars.notification["mail"] = {
    groups = [ "icingaadmins" ]
    users = [ "icingaadmin" ]
  }

  [...]
}
```
- Dịch vụ thông báo chó user và group được kế thừa từ service và nếu không được thiết lập, từ host. Người dùng mặc định cũng được đặt.


```sh
apply Notification "mail-service-notification" to Service {
  [...]

  if (service.vars.notification.mail.users) {
    users = service.vars.notification.mail.users
  } else if (host.vars.notification.mail.users) {
    users = host.vars.notification.mail.users
  } else {
    /* Default user who receives everything. */
    users = [ "icingaadmin" ]
  }

  if (service.vars.notification.mail.groups) {
    user_groups = service.vars.notification.mail.groups
  } else if (host.vars.notification.mail.groups) {
    user_groups = host.vars.notification.mail.groups
  }

  assign where ( host.vars.notification.mail && typeof(host.vars.notification.mail) == Dictionary ) || ( service.vars.notification.mail && typeof(service.vars.notification.mail) == Dictionary )
}
```

### Độ trễ thông báo và thời gian re-notification

```sh
apply Notification "mail" to Service {
  import "generic-notification"

  command = "mail-notification"
  users = [ "icingaadmin" ]

  interval = 5m  // time renotification
  
  times.begin = 15m // delay notification window

  assign where service.name == "ping4"
}


```
# 8.Commands

- icinga2 sử dụng 3 loại lệnh khác nhau để tiến hành kiểm tra

## CheckCommand

- CheckCommand xác định dòng lệnh chạy như thế nào khi check được gọi.

- Các đối tượng CheckCommand được tham chiếu bởi các đối tượng host và service bằng cách sử dụng thuộc tính `check_command`.

### Tích hợp Plugin với Định nghĩa CheckCommand

- Ta có plugin giám sát check_mysql, sử dụng lệnh help để xem các tuỳ chọn có sẵn


```sh
icinga@icinga2 $ /usr/lib64/nagios/plugins/check_mysql --help
...
This program tests connections to a MySQL server

Usage:
check_mysql [-d database] [-H host] [-P port] [-s socket]
[-u user] [-p password] [-S] [-l] [-a cert] [-k key]
[-C ca-cert] [-D ca-dir] [-L ciphers] [-f optfile] [-g group]
```

- Tạo checkcommand và định nghĩa các tuỳ chọn bằng tham số lệnh

```sh
# vim /etc/icinga2/conf.d/commands.conf

object CheckCommand "my-mysql" {
  command = [ PluginDir + "/check_mysql" ] //constants.conf -> const PluginDir

  arguments = {
    "-H" = "$mysql_host$"
    "-u" = {
      required = true
      value = "$mysql_user$"
    }
    "-p" = "$mysql_password$"
    "-P" = "$mysql_port$"
    "-s" = "$mysql_socket$"
    "-a" = "$mysql_cert$"
    "-d" = "$mysql_database$"
    "-k" = "$mysql_key$"
    "-C" = "$mysql_ca_cert$"
    "-D" = "$mysql_ca_dir$"
    "-L" = "$mysql_ciphers$"
    "-f" = "$mysql_optfile$"
    "-g" = "$mysql_group$"
    "-S" = {
      set_if = "$mysql_check_slave$"
      description = "Check if the slave thread is running properly."
    }
    "-l" = {
      set_if = "$mysql_ssl$"
      description = "Use ssl encryption"
    }
  }

  vars.mysql_check_slave = false
  vars.mysql_ssl = false
  vars.mysql_host = "$address$"
}
```

- Tạo service sử dụng plugin (đảm bảo sử dụng tất cả các tham số bắt buộc, các biến toàn cục bắt buộc là `mysql_user`, `mysql_password`  `mysql_database`,`MysqlUsername` và `MysqlPassword`.)

```sh
# vim /etc/icinga2/conf.d/services.conf

apply Service "mysql-icinga-db-health" {
  import "generic-service"

  check_command = "my-mysql"

  vars.mysql_user = MysqlUsername
  vars.mysql_password = MysqlPassword

  vars.mysql_database = "icinga"
  vars.mysql_host = "192.168.33.11"

  assign where match("icinga2*", host.name)
  ignore where host.vars.no_health_check == true
}
```


## Lệnh đối số

- Để chỉ định các tham số của tuỳ chọn plugins/scipts trong thuộc tính `arguments`
```sh
  arguments = {
    "--parameter" = {
      description = "..."
      value = "..."
    }
  }
 ```
-  Mỗi đối số được bỏ qua khi không được đặt giá trị.

 ### Giá trị
 
 ```sh
   arguments = {
    "--unit" = {
      value = "$systemd_unit$"
    }
  }
  ```
  
   - Để chỉ định giá trị ta dùng 1 biến tuỳ chỉnh bên trong checkcommand

```sh
  vars.systemd_unit = "icinga2"
  ```
  
  ### Mô tả
  
  - Cách tốt nhất là luôn sao chép output của tham số lệnh khi sử dụng `help` vào trường `description`
  
  
  ```sh
  ./check_systemd.py --help

...

  -u UNIT, --unit UNIT  Name of the systemd unit that is beeing tested.
  ```
  
  - Sao chép vào description

```sh
 arguments = {
    "--unit" = {
      value = "$systemd_unit$"
      description = "Name of the systemd unit that is beeing tested."
    }
  }
  ```
  
  ### Đối số lệnh bắt buộc
  
  - Chỉ định xem đối số có bắt buộc hay không (Theo mặc định thì tất cả đối số đều là tuỳ chọn).
```sh
  arguments = {
    "--host" = {
      value = "..."
      description = "..."
      required = true  //bắt buộc
    }
  }
  ```
  - Trường required có thể chỉ định bằng một giá trị boolean (True, False).


### Skip key

 - Thuộc tính arguments yêu cầu một khóa, các giá trị trống là không được phép. Để khắc phục điều này cho các tham số không cần tên phía trước giá trị, hãy sử dụng `skip_key` (boolean).
  
  ```sh
    command = [ PrefixDir + "/bin/icingacli", "businessprocess", "process", "check" ]

  arguments = {
    "--process" = {
      value = "$icingacli_businessprocess_process$"
      description = "Business process to monitor"
      skip_key = true
      required = true
      order = -1
    }
  }
  ```
  
- Chỉ định giá chị của biến tuỳ chỉnh "icingacli_businessprocess_process"

  ```sh
    vars.icingacli_businessprocess_process = "bp-shop-web"
```

- Điều này dẫn đến dòng lệnh này thực thi không có tham số "--process"

```sh
'/bin/icingacli' 'businessprocess' 'process' 'check' 'bp-shop-web'
```
  
 - Sử dụng phương pháp này để đưa mọi thứ vào thuộc tính `arguments` theo một thứ tự xác định và không có khóa. Điều này cũng tránh các mục nhập trong các thuộc tính `command`.
  
  ## Set if
  
  ```sh
    command = [ PluginDir + "/check_http"]

  arguments = {
    "--sni" = {
      set_if = "$http_sni$"
    }
  }
  ```
  
  - Bất cứ khi nào host/service đặt biến tuỳ chỉnh `http_sni` thành true, tham số sẽ được thêm vào dòng lệnh.
  ```sh
  '/usr/lib64/nagios/plugins/check_http' '--sni'
  ```
  
  - Các tham số có giá trị nhưng được kiểm soát bổ sung

```sh
command = [ PluginContribDir + "/check_postgres.pl" ]

  arguments = {
    "-H" = {
      value = "$postgres_host$"
      set_if = {{ macro("$postgres_unixsocket$") == false }}
      description = "hostname(s) to connect to; defaults to none (Unix socket)"
  }
  //Thông số host chỉ sử dụng giá trị value bất cứ khi nào biến tuỳ chỉnh postgres_unixsocket được đặt thành false.
  ```
  
  - Kiểm tra thực thi cho host và service.

```sh
object Host "postgresql-cluster" {
  // ...

  vars.postgres_host = "192.168.56.200"
  vars.postgres_unixsocket = false
}
```

- Lệnh thực thi tương đương

```sh
'/usr/lib64/nagios/plugins/check_postgres.pl'
```

-> Các đối tượng host/service được đặt biến tuỳ chỉnh postgres_unixsocket là false không thêm tham số -H và giá trị của nó vào dòng lệnh.

### Thứ tự

- Plugin có thể yêu cầu các thông số theo thứ tự tuỳ chỉnh.

```sh
  arguments = {
    "--first" = {
      value = "..."
      description = "..."
      order = -5
    }
    "--second" = {
      value = "..."
      description = "..."
      order = -4
    }
    "--last" = {
      value = "..."
      description = "..."
      order = 99
    }
  }
 ```
 
 - Lặp lại key

- Các tham số có thể sử dụng Mảng làm kiểu giá trị. Bất cứ khi nào Icinga gặp một mảng, nó sẽ lặp lại khóa tham số và từng phần tử giá trị theo mặc định.
  
  
  ```sh
    command = [ NscpPath + "\\nscp.exe", "client" ]

  arguments = {
    "-a" = {
      value = "$nscp_arguments$"
      description = "..."
      repeat_key = true
    }
  }
  ```
  
  - Trên một đối tượng host/service, hãy chỉ định biến tuỳ chỉnh nscp_arguments dưới dạng một mảng.
  
```sh
    vars.nscp_arguments = [ "exclude=sppsvc", "exclude=ShellHWDetection" ]
```

- Lệnh thực thi tương đương

```sh
nscp.exe 'client' '-a' 'exclude=sppsvc' '-a' 'exclude=ShellHWDetection'
```

- Nếu không muốn lặp lại khóa, hãy đặt `repeat_key = false`.  

```sh
  command = [ NscpPath + "\\nscp.exe", "client" ]

  arguments = {
    "-a" = {
      value = "$nscp_arguments$"
      description = "..."
      repeat_key = false
    }
  }
  ```
  
  - Lệnh thực thi tương đương

```sh
nscp.exe 'client' '-a' 'exclude=sppsvc' 'exclude=ShellHWDetection'
```
  
### Key

- Thuộc tính arguments yêu cầu các key duy nhất. Nếu muốn ghi đè thuộc tính dòng lệnh hãy sự dụng key với thiết lập các tên khoá khác nhau.
  
  
```sh
  arguments = {
  "--key1" = {
    value = "..."
    key = "-specialkey"
  }
  "--key2" = {
    value = "..."
    key = "-specialkey"
  }
}
```

- Câu lệnh tương đương

```sh
 '-specialkey' '...' '-specialkey' '...'
```

  
  
  
  
  
  
  
  
  
  









